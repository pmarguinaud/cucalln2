MODULE UTIL_TSPP_CONFIG_MOD

USE SPP_MOD, ONLY : TSPP_CONFIG

INTERFACE SAVE
MODULE PROCEDURE SAVE_TSPP_CONFIG
END INTERFACE

INTERFACE LOAD
MODULE PROCEDURE LOAD_TSPP_CONFIG
END INTERFACE

INTERFACE COPY
MODULE PROCEDURE COPY_TSPP_CONFIG
END INTERFACE

INTERFACE HOST
MODULE PROCEDURE HOST_TSPP_CONFIG
END INTERFACE

     
INTERFACE CRC64
MODULE PROCEDURE CRC64_TSPP_CONFIG
END INTERFACE

INTERFACE WIPE
MODULE PROCEDURE WIPE_TSPP_CONFIG
END INTERFACE

INTERFACE SIZE
MODULE PROCEDURE SIZE_TSPP_CONFIG
END INTERFACE


CONTAINS

SUBROUTINE SAVE_TSPP_CONFIG (KLUN, YD)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TSPP_CONFIG), INTENT (IN), TARGET :: YD

WRITE (KLUN) YD%LSPP
WRITE (KLUN) YD%CSPP_MODEL_NAME
CALL SAVE_SPP_MODEL (KLUN, YD%SM)
CALL SAVE_SPP_PERT_POINTER (KLUN, YD%PPTR)
WRITE (KLUN) YD%LRAMIDLIMIT1
WRITE (KLUN) YD%LUSE_SETRAN
WRITE (KLUN) YD%LNSEED_OFFS0
WRITE (KLUN) YD%LRDPATINIT
WRITE (KLUN) YD%LWRPATTRUN
WRITE (KLUN) YD%NWRPATTRUN
WRITE (KLUN) YD%NHOUR_PATTRUN
WRITE (KLUN) YD%NSTEP_PATTRUN
WRITE (KLUN) YD%LRESETSEED
WRITE (KLUN) YD%LABSTIMSEED
WRITE (KLUN) YD%RESETSEEDFRQ
WRITE (KLUN) YD%SHIFTSEED
WRITE (KLUN) YD%SPP_RDPATINIT
WRITE (KLUN) YD%SPP_WRPATTRUN
WRITE (KLUN) YD%ISEEDFAC
WRITE (KLUN) YD%IEZDIAG_POS
WRITE (KLUN) YD%NPATFR
WRITE (KLUN) YD%XPRESS_PHR_ST
WRITE (KLUN) YD%LSPG_SPP
WRITE (KLUN) YD%SPGMU
WRITE (KLUN) YD%SPGLAMBDA
WRITE (KLUN) YD%SPGSIGMA
WRITE (KLUN) YD%SPGQ
WRITE (KLUN) YD%SPGADTMIN
WRITE (KLUN) YD%SPGADTMAX
WRITE (KLUN) YD%SPGTDT
END SUBROUTINE

SUBROUTINE LOAD_TSPP_CONFIG (KLUN, YD)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
USE PARKIND1, ONLY : JPRD

IMPLICIT NONE
INTEGER, INTENT (IN) :: KLUN
TYPE (TSPP_CONFIG), INTENT (OUT), TARGET :: YD
REAL(KIND=JPRD) :: ZTMP0
READ (KLUN) YD%LSPP
READ (KLUN) YD%CSPP_MODEL_NAME
CALL LOAD_SPP_MODEL (KLUN, YD%SM)
CALL LOAD_SPP_PERT_POINTER (KLUN, YD%PPTR)
READ (KLUN) YD%LRAMIDLIMIT1
READ (KLUN) YD%LUSE_SETRAN
READ (KLUN) YD%LNSEED_OFFS0
READ (KLUN) YD%LRDPATINIT
READ (KLUN) YD%LWRPATTRUN
READ (KLUN) YD%NWRPATTRUN
READ (KLUN) YD%NHOUR_PATTRUN
READ (KLUN) YD%NSTEP_PATTRUN
READ (KLUN) YD%LRESETSEED
READ (KLUN) YD%LABSTIMSEED
READ (KLUN) YD%RESETSEEDFRQ
READ (KLUN) YD%SHIFTSEED
READ (KLUN) YD%SPP_RDPATINIT
READ (KLUN) YD%SPP_WRPATTRUN
READ (KLUN) YD%ISEEDFAC
READ (KLUN) YD%IEZDIAG_POS
READ (KLUN) YD%NPATFR
READ (KLUN) ZTMP0
YD%XPRESS_PHR_ST = ZTMP0
READ (KLUN) YD%LSPG_SPP
READ (KLUN) ZTMP0
YD%SPGMU = ZTMP0
READ (KLUN) ZTMP0
YD%SPGLAMBDA = ZTMP0
READ (KLUN) ZTMP0
YD%SPGSIGMA = ZTMP0
READ (KLUN) ZTMP0
YD%SPGQ = ZTMP0
READ (KLUN) ZTMP0
YD%SPGADTMIN = ZTMP0
READ (KLUN) ZTMP0
YD%SPGADTMAX = ZTMP0
READ (KLUN) ZTMP0
YD%SPGTDT = ZTMP0
END SUBROUTINE


SUBROUTINE COPY_TSPP_CONFIG (YD, LDCREATED, LDFIELDAPI)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
IMPLICIT NONE
TYPE (TSPP_CONFIG), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDCREATED, LDFIELDAPI
LOGICAL :: LLCREATED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF
LLCREATED = .FALSE.
IF (PRESENT (LDCREATED)) THEN
  LLCREATED = LDCREATED
ENDIF
IF (.NOT. LLCREATED) THEN
  !$acc enter data create (YD)
  !$acc update device (YD)
ENDIF


CALL COPY_SPP_MODEL (YD%SM, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL COPY_SPP_PERT_POINTER (YD%PPTR, LDCREATED=.TRUE., LDFIELDAPI=LDFIELDAPI)



























END SUBROUTINE

SUBROUTINE HOST_TSPP_CONFIG (YD)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD

IMPLICIT NONE
TYPE (TSPP_CONFIG), TARGET :: YD



CALL HOST_SPP_MODEL (YD%SM)

CALL HOST_SPP_PERT_POINTER (YD%PPTR)



























END SUBROUTINE

     

SUBROUTINE CRC64_TSPP_CONFIG (YD, KLUN, CDPATH)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
USE CRC64_INTRINSIC

IMPLICIT NONE
TYPE (TSPP_CONFIG), TARGET :: YD
INTEGER, INTENT (IN) :: KLUN
CHARACTER(LEN=*), INTENT (IN) :: CDPATH
CHARACTER(LEN=128) :: CLIND

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LSPP), CDPATH//'%LSPP'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%CSPP_MODEL_NAME), CDPATH//'%CSPP_MODEL_NAME'

CLIND = ''
CALL CRC64_SPP_MODEL (YD%SM, KLUN, CDPATH//'%SM'//TRIM(CLIND))

CLIND = ''
CALL CRC64_SPP_PERT_POINTER (YD%PPTR, KLUN, CDPATH//'%PPTR'//TRIM(CLIND))

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LRAMIDLIMIT1), CDPATH//'%LRAMIDLIMIT1'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LUSE_SETRAN), CDPATH//'%LUSE_SETRAN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LNSEED_OFFS0), CDPATH//'%LNSEED_OFFS0'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LRDPATINIT), CDPATH//'%LRDPATINIT'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LWRPATTRUN), CDPATH//'%LWRPATTRUN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%NWRPATTRUN), CDPATH//'%NWRPATTRUN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%NHOUR_PATTRUN), CDPATH//'%NHOUR_PATTRUN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%NSTEP_PATTRUN), CDPATH//'%NSTEP_PATTRUN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LRESETSEED), CDPATH//'%LRESETSEED'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LABSTIMSEED), CDPATH//'%LABSTIMSEED'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%RESETSEEDFRQ), CDPATH//'%RESETSEEDFRQ'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SHIFTSEED), CDPATH//'%SHIFTSEED'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPP_RDPATINIT), CDPATH//'%SPP_RDPATINIT'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPP_WRPATTRUN), CDPATH//'%SPP_WRPATTRUN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%ISEEDFAC), CDPATH//'%ISEEDFAC'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%IEZDIAG_POS), CDPATH//'%IEZDIAG_POS'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%NPATFR), CDPATH//'%NPATFR'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%XPRESS_PHR_ST), CDPATH//'%XPRESS_PHR_ST'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%LSPG_SPP), CDPATH//'%LSPG_SPP'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGMU), CDPATH//'%SPGMU'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGLAMBDA), CDPATH//'%SPGLAMBDA'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGSIGMA), CDPATH//'%SPGSIGMA'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGQ), CDPATH//'%SPGQ'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGADTMIN), CDPATH//'%SPGADTMIN'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGADTMAX), CDPATH//'%SPGADTMAX'

WRITE (KLUN, '(Z16.16," ",A)') CRC64 (YD%SPGTDT), CDPATH//'%SPGTDT'

END SUBROUTINE

SUBROUTINE WIPE_TSPP_CONFIG (YD, LDDELETED, LDFIELDAPI)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
IMPLICIT NONE
TYPE (TSPP_CONFIG), INTENT (IN), TARGET :: YD
LOGICAL, OPTIONAL, INTENT (IN) :: LDDELETED, LDFIELDAPI
LOGICAL :: LLDELETED
LOGICAL :: LLFIELDAPI

LLFIELDAPI = .FALSE.
IF (PRESENT (LDFIELDAPI)) THEN
  LLFIELDAPI = LDFIELDAPI
ENDIF


CALL WIPE_SPP_MODEL (YD%SM, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)

CALL WIPE_SPP_PERT_POINTER (YD%PPTR, LDDELETED=.TRUE., LDFIELDAPI=LDFIELDAPI)



























LLDELETED = .FALSE.
IF (PRESENT (LDDELETED)) THEN
  LLDELETED = LDDELETED
ENDIF
IF (.NOT. LLDELETED) THEN
  !$acc exit data delete (YD)
ENDIF
END SUBROUTINE

INTEGER*8 FUNCTION SIZE_TSPP_CONFIG (YD, CDPATH, LDPRINT) RESULT (KSIZE)
USE UTIL_SPP_MODEL_MOD
USE UTIL_SPP_PERT_POINTER_MOD
IMPLICIT NONE
TYPE (TSPP_CONFIG),     INTENT (IN), TARGET :: YD
CHARACTER(LEN=*), INTENT (IN), OPTIONAL :: CDPATH
LOGICAL,          INTENT (IN), OPTIONAL :: LDPRINT
INTEGER*8 :: ISIZE, JSIZE
LOGICAL :: LLPRINT
CHARACTER(LEN=128) :: CLPATH

LLPRINT = .FALSE.
IF (PRESENT (LDPRINT)) THEN
  LLPRINT = LDPRINT
ENDIF
CLPATH=''
IF (PRESENT (CDPATH)) THEN
  CLPATH = CDPATH
ENDIF
KSIZE = 0
ISIZE = KIND (YD%LSPP)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LSPP'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%CSPP_MODEL_NAME) * LEN (YD%CSPP_MODEL_NAME)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%CSPP_MODEL_NAME'
ENDIF
KSIZE = KSIZE + ISIZE
JSIZE = 0
ISIZE = SIZE_SPP_MODEL (YD%SM, CLPATH//'%SM', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%SM'
ENDIF
JSIZE = 0
ISIZE = SIZE_SPP_PERT_POINTER (YD%PPTR, CLPATH//'%PPTR', .FALSE.)
JSIZE = JSIZE + ISIZE
KSIZE = KSIZE + ISIZE
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') JSIZE
  WRITE (*, *) TRIM (CLPATH)//'%PPTR'
ENDIF
ISIZE = KIND (YD%LRAMIDLIMIT1)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LRAMIDLIMIT1'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LUSE_SETRAN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LUSE_SETRAN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LNSEED_OFFS0)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LNSEED_OFFS0'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LRDPATINIT)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LRDPATINIT'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LWRPATTRUN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LWRPATTRUN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NWRPATTRUN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NWRPATTRUN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NHOUR_PATTRUN) * SIZE (YD%NHOUR_PATTRUN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NHOUR_PATTRUN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NSTEP_PATTRUN) * SIZE (YD%NSTEP_PATTRUN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NSTEP_PATTRUN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LRESETSEED)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LRESETSEED'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LABSTIMSEED)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LABSTIMSEED'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%RESETSEEDFRQ)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%RESETSEEDFRQ'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SHIFTSEED)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SHIFTSEED'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPP_RDPATINIT) * LEN (YD%SPP_RDPATINIT)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPP_RDPATINIT'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPP_WRPATTRUN) * LEN (YD%SPP_WRPATTRUN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPP_WRPATTRUN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%ISEEDFAC)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%ISEEDFAC'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%IEZDIAG_POS)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%IEZDIAG_POS'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%NPATFR)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%NPATFR'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%XPRESS_PHR_ST)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%XPRESS_PHR_ST'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%LSPG_SPP)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%LSPG_SPP'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGMU)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGMU'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGLAMBDA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGLAMBDA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGSIGMA)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGSIGMA'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGQ)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGQ'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGADTMIN)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGADTMIN'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGADTMAX)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGADTMAX'
ENDIF
KSIZE = KSIZE + ISIZE
ISIZE = KIND (YD%SPGTDT)
IF (LLPRINT) THEN
  WRITE (*, '(I10," ")', ADVANCE='NO') ISIZE
  WRITE (*, *) TRIM (CLPATH)//'%SPGTDT'
ENDIF
KSIZE = KSIZE + ISIZE
END FUNCTION

END MODULE
